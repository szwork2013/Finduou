
function initMap(){var a=new google.maps.Map(document.getElementById("map"),{center:{lat:34.0522342,lng:-118.2436849},zoom:10}),b=document.getElementById("address-input-write"),c=new google.maps.places.Autocomplete(b);c.bindTo("bounds",a);var d=new google.maps.InfoWindow,e=new google.maps.Marker({map:a,anchorPoint:new google.maps.Point(0,-29)});c.addListener("place_changed",function(){d.close(),e.setVisible(!1);var b=c.getPlace();if(!b.geometry)return void window.alert("Autocomplete's returned place contains no geometry");locate.address=b.formatted_address,locate.place_id=b.place_id,locate.lat=b.geometry.location.lat(),locate.lng=b.geometry.location.lng(),b.geometry.viewport?a.fitBounds(b.geometry.viewport):(a.setCenter(b.geometry.location),a.setZoom(17)),e.setPosition(b.geometry.location),e.setVisible(!0);var f="";b.address_components&&(f=[b.address_components[0]&&b.address_components[0].short_name||"",b.address_components[1]&&b.address_components[1].short_name||"",b.address_components[2]&&b.address_components[2].short_name||""].join(" ")),d.setContent("<div><strong>"+b.name+"</strong><br>"+f),d.open(a,e)})}$(function(){(""==strdecode(getCookie("token"))||void 0==strdecode(getCookie("token"))||-1==strdecode(getCookie("token")))&&(window.location.href="index.html"),$("#header-right").find("span").eq(2).click(function(a){$("#nav-list").toggle(),a.stopPropagation()}),$(document).click(function(a){$("#active-type-select").hide(),$("#active-status-select").hide(),$("#nav-list").hide(),$("#city-select").hide()}),$("#nav-list").find("li").eq(0).click(function(a){window.location.href="index.html#resetPwd"}),$("#nav-list").find("li").eq(1).click(function(a){removeCookie("email"),removeCookie("id"),removeCookie("pwd"),removeCookie("uid"),removeCookie("USER"),removeCookie("token"),window.location.href="index.html"}),$(".city-wrap").click(function(a){$("#city-select").toggle(),a.stopPropagation()}),$("#city-select").find("li").click(function(a){$("#city-select").siblings("span").html($(this).html())}),$(".wrap").click(function(a){$(this).next().toggle(),a.stopPropagation()}),$("#active-type-select").find("li").click(function(a){$("#active-type-select").prev().find("span").html($(this).html())}),$("#active-status-select").find("li").click(function(a){$("#active-status-select").prev().find("span").html($(this).html())}),$("#upbtn").click(function(a){$("#upload").click()});var a="",b=new FormData,c=/[@#\$%\^&\*<>]+/g;$("#upload").change(function(b){var c=/[\.](jpg|gif|png|JPG|PNG|GIF|jpeg)$/;if(null==b.target.files[0].name.match(c))return $("#poster-tip").html("文件格式不正确").show(),!1;if(b.target.files[0].size>4194304)return $("#poster-tip").html("图片不能超过4M").show(),!1;var d=new FileReader;d.readAsDataURL(b.target.files[0]),d.onload=function(c){var d=new Image;d.src=this.result,d.onload=function(){900!=this.width&&500!=this.height?$("#poster-tip").html("图片尺寸900*500").show():(a=b.target.files[0],$(".photoframe").html(this),$("#poster-tip").hide())}}});var d="";$("#save").click(function(e){var f=!1;return $("#title-input-write").val().length>30?($("#title-input-write").next().html("标题过长 &nbsp &nbsp &nbsp &nbsp &nbsp").show(),f=!0):""==$("#title-input-write").val()?($("#title-input-write").next().html("请输入活动标题").show(),f=!0):c.test($("#title-input-write").val())?($("#title-input-write").next().html("非法输入 &nbsp &nbsp &nbsp &nbsp &nbsp").show(),f=!0):$("#title-input-write").next().hide(),""==$("#d422").val()||""==$("#d242").val()||""==$("#d243").val()?($("#d243").next().show(),f=!0):c.test($("#d422").val())||c.test($("#d242").val())||c.test($("#d243").val())?($("#d243").next().show(),f=!0):$("#d243").next().hide(),"请选择"==$(".city-wrap").find("span").html()?($(".city-wrap").css("borderColor","#f00"),f=!0):$(".city-wrap").css("borderColor","#cacaca"),""==$("#address-input-write").val()?($("#address-input-write").next().show(),f=!0):c.test($("#address-input-write").val())?($("#address-input-write").next().show(),f=!0):""==locate.lat&&""==locate.lng&&""==locate.place_id&&""==locate.address?($("#address-input-write").next().show(),f=!0):$("#address-input-write").next().hide(),"请选择"==$("#active-type-select").prev().find("span").html()?($("#active-type-select").prev().css("borderColor","#f00"),f=!0):$("#active-type-select").prev().css("borderColor","#cacaca"),"请选择"==$("#active-status-select").prev().find("span").html()?($("#active-status-select").prev().css("borderColor","#f00"),f=!0):$("#active-status-select").prev().css("borderColor","#cacaca"),""==$("#activity-intro").val()?($("#activity-intro").next().show(),f=!0):$("#activity-intro").val().length>300||$("#activity-intro").val().length<10?($("#activity-intro").next().show(),f=!0):c.test($("#activity-intro").val())?($("#activity-intro").next().show(),f=!0):($("#activity-intro").next().hide(),d=$("#activity-intro").val()),c.test($("#question").val())&&(f=!0,alert("报名问题不能含有非法字符")),""==a?($(".core").next().html("请上传活动海报&nbsp&nbsp").show(),f=!0):$(".core").next().hide(),f?!1:(b.append("circle_id",""),b.append("university_id",strdecode(getCookie("uid"))),b.append("type",$("#active-type-select").prev().find("span").html()),b.append("state",$("#active-status-select").prev().find("span").html()),b.append("title",$("#title-input-write").val()),b.append("set_date",$("#d422").val()),b.append("set_time_s",$("#d242").val()),b.append("set_time_e",$("#d243").val()),b.append("city",$("#city-select").siblings("span").html()),b.append("place",locate.address),b.append("longitude",locate.lng),b.append("latitude",locate.lat),b.append("place_id",locate.place_id),b.append("content",d),b.append("number",""),b.append("contact_flag",""),b.append("poster",a),b.append("creater",strdecode(getCookie("id"))),b.append("question",$("#question").val()),b.append("USER",strdecode(getCookie("USER"))),b.append("TOKEN",strdecode(getCookie("token"))),void $.ajax({url:basic.topAddress+basic.webAddress+"/UploadActivityPic.aspx",type:"POST",data:b,cache:!1,contentType:!1,processData:!1,success:function(a){a.error?(alert(a.error),window.location.href="index.html"):(alert("添加活动成功"),window.location.href="activeList.html")},error:function(a){alert(a.status+"失败")}}))})});