
var main=angular.module("FinduouApp",["ngRoute","loginModule","resetModule"]);main.config(["$routeProvider",function(a){a.when("/login",{templateUrl:"loginTemplate.html",controller:"login"}).when("/resetPwd",{templateUrl:"resetTemplate.html",controller:"reset"}).otherwise({redirectTo:"/login"})}]),main.controller("login",["$scope","$location","Login",function(a,b,c){a.$location=b,a.keyLogin=function(b){if(13==b.keyCode)if(reg.test(a.userEmail)&&""!=a.userPwd&&void 0!=a.userPwd){var d=c.userLogin({a:a.userEmail,b:a.userPwd});d.then(function(b){b.error?alert(b.error):(setCookie("email",a.userEmail,14),setCookie("id",b.Head[0].id,14),setCookie("token",b.Head[0].token,14),setCookie("uid",b.Head[0].university_id,14),window.location.href="activeList.html")},function(){})}else""==a.userEmail||void 0==a.userEmail?alert("邮箱不能为空!"):0==reg.test(a.userEmail)?alert("邮箱格式不正确!"):(""==a.userPwd||void 0==a.userPwd)&&alert("亲！别忘了密码！")},a.loginOperate=function(){if(reg.test(a.userEmail)&&""!=a.userPwd&&void 0!=a.userPwd){var b=c.userLogin({a:a.userEmail,b:a.userPwd});b.then(function(b){b.error?alert(b.error):(setCookie("email",a.userEmail,14),setCookie("id",b.Head[0].id,14),setCookie("token",b.Head[0].token,14),setCookie("uid",b.Head[0].university_id,14),window.location.href="activeList.html")},function(){})}else""==a.userEmail||void 0==a.userEmail?alert("邮箱不能为空!"):0==reg.test(a.userEmail)?alert("邮箱格式不正确!"):(""==a.userPwd||void 0==a.userPwd)&&alert("亲！别忘了密码！")}}]),main.controller("reset",["$scope","$interval","$location","SendCode","Reset",function(a,b,c,d,e){a.$location=c,a.wait="发送邮箱验证码",a.idCode="",a.newPwd="",a.resurePwd="",a.onoff=!1,a.sending=function(){var c=null;if(0==a.onoff){var e=d.Send(a.resetEmail);a.onoff=!0,e.then(function(){alert("已发送,请接收!")},function(a){alert(a)})}else{a.onoff=!0;var f=60;c=b(function(){f--,0==f?(a.wait="发送邮箱验证码",a.onoff=!1,b.cancel(c)):a.wait="重新获取("+f+")"},1e3)}},a.resetOperate=function(){if(0==reg.test(a.resetEmail))alert("邮箱格式不正确!");else if(void 0==a.idCode||""==a.idCode)alert("请输入验证码");else if(""==a.newPwd||void 0==a.newPwd||""==a.resurePwd||void 0==a.resurePwd)alert("密码不能为空");else if(a.newPwd!=a.resurePwd)alert("密码不一致");else{var b=e.userReset({a:a.resetEmail,b:a.idCode,c:a.newPwd});b.then(function(){c.path("login")},function(){})}}}]);var loginModule=angular.module("loginModule",[]);loginModule.factory("Login",["$http","$q",function(a,b){return{userLogin:function(c){var d=b.defer();return a({url:basic.topAddress+basic.subAddress+"sys_user_adminWs.asmx/Login?jsoncallback=JSON_CALLBACK",method:"JSONP",params:{login_name:c.a,login_pwd:c.b}}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject()}),d.promise}}}]);var resetModule=angular.module("resetModule",[]);resetModule.factory("SendCode",["$http","$q","$location",function(a,b,c){return{Send:function(c){var d=b.defer();return a({url:basic.topAddress+basic.subAddress+"sys_user_adminWs.asmx/SendCodeToEmail?jsoncallback=JSON_CALLBACK",method:"JSONP",params:{email:c}}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(a)}),d.promise}}}]),resetModule.factory("Reset",["$http","$q","$location",function(a,b,c){return{userReset:function(c){console.log(c);var d=b.defer();return a({url:basic.topAddress+basic.subAddress+"sys_user_adminWs.asmx/UpdatePwdFromCode?jsoncallback=JSON_CALLBACK",method:"JSONP",params:{email:c.a,code:c.b,login_pwd:c.c}}).success(function(a,b,c,e){console.log(a),d.resolve(a)}).error(function(a,b,c,e){d.reject()}),d.promise}}}]);